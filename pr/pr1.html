<h1>자율주행자동차</h1>
<h2>1. 개요</h2>
<blockquote>
<p>자율주행자동차 키트와 센서를 사용하여 아래와 같은 트랙을 빠져나오는 프로젝트</p>
</blockquote>
<h2>2. 개발 과정</h2>
<blockquote>
<p>자동차 키트를 사용하고 초음파 센서 3개를 사용했다.</p>
</blockquote>
<h3>하드웨어 조립</h3>
<ul>
<li><p>조립</p>
<p><img height="300" width="300" src="https://github.com/rim0621/RobotSW/blob/master/autonomousVehicle/img/making.jpg?raw=true"></p>
</li>
<li><p>측면</p>
<p><img height="300" width="300" src="https://raw.githubusercontent.com/rim0621/RobotSW/master/autonomousVehicle/img/left.jpg"></p>
</li>
<li><p>앞</p>
<p><img height="300" width="300" src="https://raw.githubusercontent.com/rim0621/RobotSW/master/autonomousVehicle/img/front.jpg"></p>
</li>
</ul>
<blockquote>
<p>처음에는 앞과 왼쪽에 초음파 센서를 사용하여 left hand알고리즘을 사용하려고 하였으나 오른쪽에 부딪힐 경우 예외처리로 빠져나오기 위해서 오른쪽도 센서를 달아 3개를 사용하였다.</p>
</blockquote>
<h3>PID제어</h3>
<pre class="editor-colors lang-c"><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>float</span></span><span>&nbsp;ki</span><span class="syntax--punctuation syntax--separator syntax--delimiter syntax--c"><span>,</span></span><span>kp</span><span class="syntax--punctuation syntax--separator syntax--delimiter syntax--c"><span>,</span></span><span>kd</span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>int</span></span><span>&nbsp;speed</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--separator syntax--delimiter syntax--c"><span>,</span></span><span>pre_speed</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--separator syntax--delimiter syntax--c"><span>,</span></span><span>cnt</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>float</span></span><span>&nbsp;err</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>float</span></span><span>&nbsp;i</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>float</span></span><span>&nbsp;d</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--separator syntax--delimiter syntax--c"><span>,</span></span><span>p</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>float</span></span><span>&nbsp;lsterr</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--constant syntax--numeric syntax--c"><span>0</span></span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span class="syntax--storage syntax--type syntax--c"><span>float</span></span><span>&nbsp;pivot</span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--c"><span>p</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>kp</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>err</span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>i</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>i</span><span class="syntax--keyword syntax--operator syntax--c"><span>+</span></span><span>ki</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>err</span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--c"><span>d</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span class="syntax--punctuation syntax--section syntax--parens syntax--begin syntax--bracket syntax--round syntax--c"><span>(</span></span><span>err</span><span class="syntax--keyword syntax--operator syntax--c"><span>-</span></span><span>lsterr</span><span class="syntax--punctuation syntax--section syntax--parens syntax--end syntax--bracket syntax--round syntax--c"><span>)</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>&nbsp;kd</span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--c"><span>;</span></span></span></div></pre>
<p><img height="300" width="300" src="https://github.com/rim0621/RobotSW/blob/master/autonomousVehicle/img/PID1.png?raw=true"></p>
<blockquote>
<p>PID제어 데이터를 뽑은 결과 다음과 같이 나왔다.</p>
<p>초흠파거리센서가 0.001초 마다 가져와서 제대로된 제어가 안되는 거라고 판단해서 0.1초마다 가져오기위해 메인에 슬립을 주었다.</p>
</blockquote>
<p><img height="300" width="300" src="https://github.com/rim0621/RobotSW/blob/master/autonomousVehicle/img/PID2.png?raw=true"></p>
<blockquote>
<p>그 결과 제어가 좀더 가능해 졌다.</p>
<p>처음에는 제어를 잘했지만 뒤쪽에는 직선 구간이 부딪히는 상황이 생겨서 값이 뛰어 제어가 잘 안되는 것을 볼 수 있다.</p>
<p>게인값 -&gt; kp=4 ki=0.0002 kd=25</p>
</blockquote>
<h3>코드</h3>
<blockquote>
<p>코드 부분은 모터 동작(직진,후진,왼쪽,오른쪽턴)을 함수로 구현하였다.</p>
<p>모터의 하드웨어적 문제가 발생하여(왼 바퀴가 더 센데 초기값을 주면 굴러가지가 않음) 순간적으로 255의 값을 PWM을 주어서 왼쪽 바퀴를 굴길 수 있게 하였다.</p>
<p>쓰레드를 3개 사용하여 각각의 초음파센서의 값을 받아오도록 하였다.</p>
<p>메인에는 발생할 상황을 조건문으로 나누어서 각각의 상황에 맞에 구현하였다.</p>
<p>초음파 센서가 받아오는 값이 너무 빨라서 제어를 좀더 정확하게 하기위해서 0.1초의 딜레이를 주었다.</p>
</blockquote>
<ul>
<li><p><a href="https://github.com/rim0621/RobotSW/blob/master/autonomousVehicle/Last_project.c">코드 링크</a></p>
</li>
<li><p><a href="https://github.com/rim0621">깃허브</a></p>
</li>
<li><p><a href="https://rim0621.tistory.com">다른 내용보기</a></p>
</li>
</ul>
<h3>시연 동영상 (클릭)</h3>
<blockquote>
<p>제어 처음 부분</p>
</blockquote>
<p><a href="https://youtu.be/N2R50nhmHQM"><img alt="Video Label" src="http://img.youtube.com/vi/N2R50nhmHQM/0.jpg"></a></p>
<h2>3. 결과</h2>
<h3>최종 시연 동영상 (클릭)</h3>
<p><a href="https://youtu.be/Ha9_MP4FB44"><img alt="Video Label" src="http://img.youtube.com/vi/Ha9_MP4FB44/0.jpg"></a></p>
<h2>4. 사용기술</h2>
<ul>
<li><p>C</p>
</li>
<li><p>라즈베리파이 &amp; 초음파 센서</p>
</li>
<li><p>pigpiod 라이브러리</p>
</li>
<li><p>PID 제어</p>
</li>
</ul>
